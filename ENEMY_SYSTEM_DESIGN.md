# Enemy System Design Documentation

## **Резюме: Универсальная система врагов для Tower Defence**

### **Архитектурное решение:**
Единый класс **`Enemy`** + компонентная система покрывает всех врагов из дизайн документа (11 типов: от животных до суккубов).

### **Основные компоненты:**
- **`HealthComponent`** - здоровье и смерть
- **`MovementComponent`** - движение по пути  
- **`ResistanceComponent`** - сопротивления (магия, стихии, ментальное)
- **`AbilityComponent`** - способности (поддержка, атака, пассивные)

### **Система конфигураций:**
- **`EnemyConfig`** - ScriptableObject с настройками отдельного типа врага
- **`EnemyVisualConfig`** - ScriptableObject с визуальными данными врага (префабы, анимации)
- **`EnemyConfigRepository`** - ScriptableObject-репозиторий всех конфигураций врагов
- **`EnemyType`** - enum с типами врагов
- **`AbilityType`**, **`ResistanceType`** - enums для способностей и сопротивлений

### **Структура репозитория конфигураций:**
```csharp
EnemyConfigRepository
├── GetEnemyConfig(EnemyType type) 
├── GetEnemyVisualConfig(EnemyType type)
├── GetEnemyConfigById(string enemyId)
├── EnemyConfigs (IReadOnlyList<EnemyConfig>)
├── EnemyVisualConfigs (IReadOnlyList<EnemyVisualConfig>)
└── [CreateAssetMenu] для создания в редакторе
```

### **EnemyVisualConfig содержит:**
```csharp
EnemyVisualConfig
├── EnemyType enemyType
├── GameObject enemyPrefab
├── AnimationClips[] animations
├── Material[] materials
├── AudioClips[] soundEffects
└── ParticleSystem[] effects
```

### **Сервисная архитектура:**
```
WaveService (управление волнами)
    ↓
EnemyService (управление отдельными врагами)
    ↓ (получает конфигурации и префабы)
EnemyConfigRepository (централизованное хранение конфигов + визуала)
    ↓  
IPoolService + IGameFactory (создание объектов)
```

### **Разделение ответственности:**
- **`WaveService`** - последовательность волн, состав, таймеры
- **`EnemyService`** - спавн, трекинг, движение отдельных врагов
- **`EnemyConfigRepository`** - централизованный доступ к конфигурациям и префабам врагов
- **`EnemyConfig`** - игровая логика врага (характеристики, способности)
- **`EnemyVisualConfig`** - визуальное представление врага (префабы, эффекты)
- **`Enemy`** - поведение конкретного экземпляра врага

### **Интеграция с существующей архитектурой:**
- Использует готовые `IPoolService` и `IGameFactory`
- Следует паттерну репозиториев по аналогии с `LevelConfigRepository`
- Разделение логики и визуала как в `LevelConfig` + `LevelVisualConfig`
- Следует паттерну Dependency Injection через Zenject
- Настройка через ScriptableObject конфигурации
- События через R3 для реактивности

### **Размещение файлов:**
- `/Assets/Resources/Configs/EnemyConfigRepository.asset` - основной репозиторий
- `/Assets/Resources/Configs/Enemies/` - отдельные игровые конфигурации врагов
- `/Assets/Resources/Configs/EnemiesVisual/` - отдельные визуальные конфигурации врагов
- Доступ через `IConfigService.GetConfig<EnemyConfigRepository>()`

## **Система спавна врагов:**

### **SpawnPoint - точка появления врагов:**
Система спавна уже реализована в проекте как часть системы путей:

```csharp
SpawnPoint
├── Vector3 SpawnDirection - направление появления врагов
├── float SpawnRadius - радиус зоны спавна
├── int MaxConcurrentEnemies - максимум одновременных врагов
├── GetRandomSpawnPosition() - случайная позиция в зоне
└── GetSpawnDirection() - направление для врага
```

### **Интеграция с EnemyService:**

**EnemyService** получает SpawnPoint через **LevelMap**:
```csharp
// Получение точки спавна с карты уровня
LevelMap levelMap = FindObjectOfType<LevelMap>();
SpawnPoint spawnPoint = levelMap.SpawnPoint;

// Спавн врага в случайной позиции
Vector3 spawnPosition = spawnPoint.GetRandomSpawnPosition();
Vector3 spawnDirection = spawnPoint.GetSpawnDirection();
```

### **Workflow спавна:**

1. **WaveService** определяет, что нужно заспавнить врага
2. **WaveService** запрашивает у **EnemyService** создание врага
3. **EnemyService** получает **SpawnPoint** с **LevelMap**
4. **EnemyService** использует `GetRandomSpawnPosition()` для позиции
5. **EnemyService** создает врага через **IPoolService**
6. **Enemy** инициализируется с **MovementComponent** для движения по пути

### **Особенности SpawnPoint:**
- Зеленые gizmos в редакторе показывают SpawnPoint
- Полупрозрачная сфера показывает радиус спавна
- Стрелка показывает направление спавна
- Встроенная валидация проверяет корректность настроек
- Один SpawnPoint на уровень (контролируется LevelMap)
- Автоматическое позиционирование на terrain

## **Типы врагов из дизайн документа:**

### **Категории врагов:**

**1. Животные** (первый уровень опасности)
- Небольшой урон
- Специальные способности, влияющие на героев и дополнительные отряды
- Отсутствие сопротивляемости к магии
- Возможная хорошая сопротивляемость к некоторым стихиям

**2. Магические твари**
- Монстры этого мира под влиянием магии
- Обитают в укромных уголках мира
- Ограниченные магические способности и умения против героинь
- Определенная устойчивость к магии и элементам
- Урон выше, чем у животных

**3. Бандиты**
- Плохо вооруженные мужчины в плохих доспехах
- Близкий к среднему физический урон
- Отсутствие сопротивляемости к магии
- Базовая защита от некоторых элементов

**4. Воины**
- Базовые боевые отряды с хорошим вооружением и защитой
- Средний физический урон
- Отсутствие сопротивляемости к магии
- Определенная сопротивляемость к некоторым стихиям

**5. Рыцари**
- Элитные боевые единицы
- Превосходное вооружение и защита от физического урона
- Отсутствие защиты от магии
- Некоторая защита от некоторых элементов

**6. Наемники**
- Легкозащищенные бойцы с быстрым перемещением
- Физический урон как у рыцарей
- Очень слабая физическая защита
- Неплохая защита от стихий

### **Отряды поддержки:**

**7. Барды**
- Невооруженные отряды ментального воздействия
- Снимают некоторые ментальные эффекты
- Усиливают силу удара союзников
- Снижают урон от элементов

**8. Алхимики**
- Невооруженные отряды медикаментозной помощи
- Лечение эликсирами
- Увеличение сопротивляемости к элементам настойками

**9. Священники**
- Невооруженные отряды магической помощи
- Развеивают ловушки на пути
- Блокируют некоторые ментальные атаки
- Ослабляют магические удары
- Увеличивают силу удара и лечат раны

### **Высокоуровневые враги:**

**10. Монстры**
- Пришедшие из-за пределов этого плана
- Больший физический урон + магические удары
- Улучшенная защита от физического урона
- Базовая магическая защита
- Хорошая устойчивость к стихиям

**11. Суккубы** (элитные отряды вторжения)
- Планировщики и организаторы вторжения
- Физический урон на уровне воинов
- Непревзойденная магическая мощь
- Значительно ослабляют магические удары
- Иммунитет к некоторым ментальным ударам
- Окутывают союзников защитными полями
- Нейтрализуют применение очарования
- Выводят из строя отряды поддержки

## **Планы развития системы:**

### **🔴 Критичные компоненты (приоритет 1):**
- **`IDamageable`** интерфейс - для получения урона от башен/заклинаний
- **`DamageType`** enum - физический, магический, элементальный урон  
- **Система иммунитетов** - сопротивляемость к определенным типам урона
- **AI поведение** - базовая логика движения и взаимодействий

### **🟡 Важные системы (приоритет 2):**
- **Система статусных эффектов** - замедление, поджог, оглушение, очарование
- **Система наград** - опыт, ресурсы, дроп за убийство врагов
- **Анимации** - ходьба, атака, смерть, получение урона
- **Звуковая система** - звуки движения, способностей, смерти

### **🟢 Дополнительные функции (приоритет 3):**
- **Групповое поведение** - барды/алхимики следуют за воинами
- **Визуальные эффекты** - particles, UI полоски здоровья
- **Система взаимодействий** - коллизии, реакция на окружение
- **Балансировка** - scaling по уровням, элитные версии

### **🔵 Оптимизация и полировка (приоритет 4):**
- **LOD система** - упрощение дальних врагов
- **Culling** - отключение невидимых врагов
- **Debug UI** - отображение состояния врага в редакторе
- **Профилирование** - мониторинг производительности

**Результат:** Масштабируемое решение без дублирования кода с централизованным управлением конфигурациями врагов по проверенному паттерну проекта, с четким разделением игровой логики и визуального представления.
